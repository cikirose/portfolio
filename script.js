// Translation data
const translations = {
    sr: {
        // Navigation
        'nav.home': 'Poƒçetna',
        'nav.portfolio': 'Portfolio',
        'nav.cv': 'CV',
        'nav.contact': 'Kontakt',
        
        // Loading
        'loading.text': 'Uƒçitavanje portfolija...',
        
        // Hero section
        'hero.title': 'Zdravo, ja sam <span class="highlight">Aleksandar Jankoviƒá</span>',
        'hero.subtitle': '',
        'hero.intro1': 'Diplomirani in≈æenjer Raƒçunarske tehnike. Trenutno sam zaposlen u kompaniji EB Infinity (Remote, USA), gde upravljam podacima za sopstveni portfolio od preko 70 kamiona, radeƒái sa digitalnim sistemima, strukturisanim podacima i bazama, uz fokus na taƒçnost evidencije, organizaciju procesa i unapreƒëenje sistema.',
        'hero.intro2': 'Posebno interesovanje usmeravam ka back-end razvoju i radu sa bazama podataka, sa ciljem daljeg profesionalnog usavr≈°avanja u ovoj oblasti. U skorijoj buduƒánosti planiram da pro≈°irim znanje i na front-end tehnologije, kako bih izgradio kompletan full-stack profil.',
        'hero.viewWork': 'Vidi moj rad',
        'hero.contact': 'Kontaktiraj me',
        
        
        // Portfolio section
        'portfolio.title': 'Portfolio projekti',
        'portfolio.teamble.title': 'Teamble - Project Manager Aplikacija',
        'portfolio.teamble.description': 'Aplikacija dizajnirana za efikasnu organizaciju i praƒáenje projekata, zadataka i timske saradnje',
        'portfolio.teambuildstay.title': 'TeamBuildStay - Rezervacije kuƒáa',
        'portfolio.teambuildstay.description': 'Aplikacija koja omoguƒáava jednostavno pretra≈æivanje i rezervaciju privatnih kuƒáa, posebno namenjenih za organizaciju team building dogaƒëaja',
        'portfolio.video.title': 'Video Monta≈æa Projekti',
        'portfolio.video.description': 'Profesionalni video monta≈æa projekti koristeƒái Adobe Premiere Pro i CapCut',
        
        // CV section
        'cv.title': 'CV & Obrazovanje',
        'cv.education.title': 'Obrazovanje',
        'cv.education.college.date': '2020 - 2025',
        'cv.education.college.school': 'Visoka ≈°kola elektrotehnike i raƒçunarstva',
        'cv.education.college.field': 'Smer: Raƒçunarska tehnika',
        'cv.education.college.location': 'Mesto: Beograd',
        'cv.education.highschool.date': '2016 - 2020',
        'cv.education.highschool.school': 'Ekonomska ≈°kola U≈æice',
        'cv.education.highschool.field': 'Smer: Finansijski administrator',
        'cv.education.highschool.location': 'Mesto: U≈æice',
        'cv.experience.title': 'Radno iskustvo',
        'cv.experience.current.date': 'Oktobar 2025 - Trenutno',
        'cv.experience.current.position': 'EB Infinity - Fleet Maintenance Representative',
        'cv.experience.current.company': 'Remote, USA',
        'cv.experience.current.task1': 'Rad sa strukturisanim podacima i bazama evidencija (servisi, kvarovi, tro≈°kovi), ukljuƒçujuƒái unos, a≈æuriranje i analizu podataka',
        'cv.experience.current.task2': 'Obuka novih zaposlenih za rad u sistemima, razumevanje procesa i po≈°tovanje kompanijskih pravila',
        'cv.experience.current.task3': 'Analiza operativnih i servisnih podataka radi optimizacije procesa i smanjenja downtime-a flote',
        'cv.experience.previous.date': 'April 2025 - Oktobar 2025',
        'cv.experience.previous.position': 'Level 1 Support Point of Sale - Sainsbury\'s',
        'cv.experience.previous.company': 'NCR Voyix - Beograd',
        'cv.experience.previous.task1': 'Sna≈æna tehniƒçka osnova: Ve≈°tine u dijagnostici, odr≈æavanju i optimizaciji POS i samouslu≈ænih kasa',
        'cv.experience.previous.task2': 'Analitiƒçko razmi≈°ljanje i re≈°avanje problema pod pritiskom vremena',
        'cv.experience.previous.task3': 'Rad sa IT infrastrukturom i korporativnim softverskim alatima',
        'cv.skills.title': 'Dodatne ve≈°tine',
        'cv.skills.languages.title': 'Jezici i softver',
        'cv.skills.languages.english': '<strong>Engleski:</strong> Napredni nivo',
        'cv.skills.languages.office': '<strong>MS Office:</strong> Word, Excel, PowerPoint',
        'cv.skills.languages.video': '<strong>Video monta≈æa:</strong> Adobe Premiere Pro, CapCut',
        'cv.skills.languages.programming': '<strong>Programiranje:</strong> Java, Docker, MySQL, Git, EmailJS, XAMPP, DBeaver',
        
        // Contact section
        'contact.title': 'Kontaktiraj me',
        'contact.info.title': 'Informacije',
        'contact.info.location': 'Belgrade',
        'contact.info.linkedin': 'LinkedIn Profile',
        'contact.info.github': 'GitHub Profile',
        'contact.form.name': 'Va≈°e ime',
        'contact.form.email': 'Va≈° email',
        'contact.form.subject': 'Naslov',
        'contact.form.message': 'Va≈°a poruka',
        'contact.form.submit': 'Po≈°alji poruku',
        
        // Footer
        'footer.copyright': '¬© 2025 Aleksandar Jankoviƒá Portfolio. Sva prava zadr≈æana.',
        
        // Form notifications
        'form.fillAllFields': 'Molimo popunite sva polja.',
        'form.validEmail': 'Molimo unesite validan email.',
        'form.sending': 'Poruka se ≈°alje...',
        'form.success': 'Poruka je uspe≈°no poslata!',
        'form.error': 'Gre≈°ka pri slanju poruke. Poku≈°aj ponovo.'
    },
    en: {
        // Navigation
        'nav.home': 'Home',
        'nav.portfolio': 'Portfolio',
        'nav.cv': 'CV',
        'nav.contact': 'Contact',
        
        // Loading
        'loading.text': 'Loading portfolio...',
        
        // Hero section
        'hero.title': 'Hello, I am <span class="highlight">Aleksandar Jankoviƒá</span>',
        'hero.subtitle': '',
        'hero.intro1': 'Graduated Computer Engineering engineer. I am currently employed at EB Infinity (Remote, USA), where I manage data for my own portfolio of over 70 trucks, working with digital systems, structured data and databases, with a focus on record accuracy, process organization and system improvement.',
        'hero.intro2': 'I focus my interest particularly on back-end development and working with databases, with the goal of further professional development in this field. In the near future, I plan to expand my knowledge to front-end technologies as well, in order to build a complete full-stack profile.',
        'hero.viewWork': 'View my work',
        'hero.contact': 'Contact me',
        
        
        // Portfolio section
        'portfolio.title': 'Portfolio projects',
        'portfolio.teamble.title': 'Teamble - Project Manager Application',
        'portfolio.teamble.description': 'Application designed for efficient organization and tracking of projects, tasks and team collaboration',
        'portfolio.teambuildstay.title': 'TeamBuildStay - House Reservations',
        'portfolio.teambuildstay.description': 'Application that enables easy search and reservation of private houses, specially designed for organizing team building events',
        'portfolio.video.title': 'Video Editing Projects',
        'portfolio.video.description': 'Professional video editing projects using Adobe Premiere Pro and CapCut',
        
        // CV section
        'cv.title': 'CV & Education',
        'cv.education.title': 'Education',
        'cv.education.college.date': '2020 - 2025',
        'cv.education.college.school': 'Higher School of Electrical Engineering and Computer Science',
        'cv.education.college.field': 'Field: Computer Engineering',
        'cv.education.college.location': 'Location: Belgrade',
        'cv.education.highschool.date': '2016 - 2020',
        'cv.education.highschool.school': 'Economic School U≈æice',
        'cv.education.highschool.field': 'Field: Financial Administrator',
        'cv.education.highschool.location': 'Location: U≈æice',
        'cv.experience.title': 'Work experience',
        'cv.experience.current.date': 'October 2025 - Present',
        'cv.experience.current.position': 'EB Infinity - Fleet Maintenance Representative',
        'cv.experience.current.company': 'Remote, USA',
        'cv.experience.current.task1': 'Working with structured data and record databases (services, breakdowns, costs), including data entry, updates and analysis',
        'cv.experience.current.task2': 'Training new employees to work in systems, understanding processes and respecting company rules',
        'cv.experience.current.task3': 'Analysis of operational and service data to optimize processes and reduce fleet downtime',
        'cv.experience.previous.date': 'April 2025 - October 2025',
        'cv.experience.previous.position': 'Level 1 Support Point of Sale - Sainsbury\'s',
        'cv.experience.previous.company': 'NCR Voyix - Belgrade',
        'cv.experience.previous.task1': 'Strong technical foundation: Skills in diagnostics, maintenance and optimization of POS and self-service checkouts',
        'cv.experience.previous.task2': 'Analytical thinking and problem solving under time pressure',
        'cv.experience.previous.task3': 'Working with IT infrastructure and corporate software tools',
        'cv.skills.title': 'Additional skills',
        'cv.skills.languages.title': 'Languages and software',
        'cv.skills.languages.english': '<strong>English:</strong> Advanced level',
        'cv.skills.languages.office': '<strong>MS Office:</strong> Word, Excel, PowerPoint',
        'cv.skills.languages.video': '<strong>Video editing:</strong> Adobe Premiere Pro, CapCut',
        'cv.skills.languages.programming': '<strong>Programming:</strong> Java, Docker, MySQL, Git, EmailJS, XAMPP, DBeaver',
        
        // Contact section
        'contact.title': 'Contact me',
        'contact.info.title': 'Information',
        'contact.info.location': 'Belgrade',
        'contact.info.linkedin': 'LinkedIn Profile',
        'contact.info.github': 'GitHub Profile',
        'contact.form.name': 'Your name',
        'contact.form.email': 'Your email',
        'contact.form.subject': 'Subject',
        'contact.form.message': 'Your message',
        'contact.form.submit': 'Send message',
        
        // Footer
        'footer.copyright': '¬© 2025 Aleksandar Jankoviƒá Portfolio. All rights reserved.',
        
        // Form notifications
        'form.fillAllFields': 'Please fill in all fields.',
        'form.validEmail': 'Please enter a valid email.',
        'form.sending': 'Sending message...',
        'form.success': 'Message sent successfully!',
        'form.error': 'Error sending message. Please try again.'
    }
};

// DOM Content Loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all functionality
    initLanguageToggle();
    initThemeToggle();
    initNavigation();
    initContactForm();
    initScrollEffects();
    initPortfolioItems();
});

// Language Toggle functionality
function initLanguageToggle() {
    const languageToggle = document.getElementById('languageToggle');
    const languageText = document.getElementById('languageText');
    
    // Check for saved language preference or default to Serbian
    const savedLanguage = localStorage.getItem('language') || 'sr';
    setLanguage(savedLanguage);
    
    // Language toggle event listener
    if (languageToggle) {
        languageToggle.addEventListener('click', function() {
            const currentLanguage = document.documentElement.getAttribute('lang');
            const newLanguage = currentLanguage === 'sr' ? 'en' : 'sr';
            setLanguage(newLanguage);
        });
    }
    
    function setLanguage(language) {
        // Update HTML lang attribute
        document.documentElement.setAttribute('lang', language);
        localStorage.setItem('language', language);
        
        // Update language toggle button text
        if (languageText) {
            languageText.textContent = language === 'sr' ? 'ENG' : 'SRB';
        }
        
        // Apply translations
        applyTranslations(language);
        
        // Add smooth transition for language change
        document.body.style.transition = 'opacity 0.2s ease';
        setTimeout(() => {
            document.body.style.transition = '';
        }, 200);
    }
}

// Apply translations to the page
function applyTranslations(language) {
    const currentTranslations = translations[language];
    
    if (!currentTranslations) {
        console.error('Translations not found for language:', language);
        return;
    }
    
    // Translate elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (currentTranslations[key]) {
            element.innerHTML = currentTranslations[key];
        }
    });
    
    // Translate placeholders
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (currentTranslations[key]) {
            element.placeholder = currentTranslations[key];
        }
    });
    
    // Update document title and meta tags based on language
    if (language === 'en') {
        document.title = 'Aleksandar Jankoviƒá Portfolio';
        const metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription) {
            metaDescription.content = 'Portfolio of Aleksandar Jankoviƒá - developer with knowledge of Java, Docker, MySQL. Final year student of computer engineering.';
        }
    } else {
        document.title = 'Aleksandar Jankoviƒá Portfolio';
        const metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription) {
            metaDescription.content = 'Portfolio Aleksandra Jankoviƒáa - developer sa znanjem Java, Docker, MySQL. Diplomirani in≈æenjer raƒçunarske tehnike.';
        }
    }
}

// Theme Toggle functionality
function initThemeToggle() {
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const body = document.body;
    
    // Check for saved theme preference or default to dark mode
    const savedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(savedTheme);
    
    // Theme toggle event listener
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        });
    }
    
    function setTheme(theme) {
        body.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        // Update icon
        if (themeIcon) {
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }
        
        // Add smooth transition for theme change
        body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
        setTimeout(() => {
            body.style.transition = '';
        }, 300);
    }
}

// Navigation functionality
function initNavigation() {
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('.nav-menu');
    const navLinks = document.querySelectorAll('.nav-link');

    // Mobile menu toggle
    if (hamburger) {
        hamburger.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            hamburger.classList.toggle('active');
        });
    }

    // Smooth scrolling for navigation links
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                targetSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }

            // Close mobile menu if open
            if (navMenu.classList.contains('active')) {
                navMenu.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });
    });

    // Active navigation link highlighting
    window.addEventListener('scroll', function() {
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');
        
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (pageYOffset >= sectionTop - 200) {
                current = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    });
}

// Contact form functionality
function initContactForm() {
    const contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const name = formData.get('name');
            const email = formData.get('email');
            const subject = formData.get('subject');
            const message = formData.get('message');
            
            // Basic validation
            if (!name || !email || !subject || !message) {
                const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
                const errorMessage = translations[currentLanguage]['form.fillAllFields'];
                showNotification(errorMessage, 'error');
                return;
            }
            
            if (!isValidEmail(email)) {
                const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
                const errorMessage = translations[currentLanguage]['form.validEmail'];
                showNotification(errorMessage, 'error');
                return;
            }
            
            // Send email using EmailJS - No backend needed!
            const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
            const sendingMessage = translations[currentLanguage]['form.sending'];
            showNotification(sendingMessage, 'info');
            
            // Send email using EmailJS (GitHub Pages compatible!)
            console.log('üöÄ Koristim EmailJS za slanje email-a...');
            
            // Check if EmailJS is loaded
            if (typeof emailjs === 'undefined') {
                console.log('üì¶ Uƒçitavam EmailJS biblioteku...');
                
                // Load EmailJS dynamically
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                script.onload = () => {
                    console.log('‚úÖ EmailJS biblioteka uƒçitana!');
                    emailjs.init('eZ1ToHn60D72IrUw-'); // Public Key
                    sendEmailViaEmailJS();
                };
                script.onerror = () => {
                    console.error('‚ùå Gre≈°ka pri uƒçitavanju EmailJS biblioteke!');
                    const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
                    const errorMessage = translations[currentLanguage]['form.error'];
                    showNotification(errorMessage, 'error');
                };
                document.head.appendChild(script);
            } else {
                console.log('‚úÖ EmailJS veƒá je uƒçitan!');
                sendEmailViaEmailJS();
            }
            
            function sendEmailViaEmailJS() {
                // EmailJS template parametri
                const templateParams = {
                    from_name: name,
                    from_email: email,
                    subject: subject,
                    message: message,
                    to_email: 'aleksandarjankovic159@gmail.com' // Tvoj email
                };
                
                console.log('üìß ≈†aljem email sa parametrima:', templateParams);
                
                // Po≈°alji email preko EmailJS
                emailjs.send(
                    'service_7eklp8j',    // Gmail service ID
                    'template_6q8y275',   // Email template ID
                    templateParams
                )
                .then(function(response) {
                    console.log('‚úÖ Email poslat uspe≈°no!', response.status, response.text);
                    console.log('üìä Response details:', response);
                    const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
                    const successMessage = translations[currentLanguage]['form.success'];
                    showNotification(successMessage, 'success');
                    contactForm.reset();
                }, function(error) {
                    console.error('‚ùå GRE≈†KA pri slanju email-a:', error);
                    console.error('üìã Error details:', error.text || error.message || error);
                    const currentLanguage = document.documentElement.getAttribute('lang') || 'sr';
                    const errorMessage = translations[currentLanguage]['form.error'];
                    showNotification(errorMessage, 'error');
                });
            }
        });
    }
}

// Email validation
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Notification system
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-message">${message}</span>
            <button class="notification-close">&times;</button>
        </div>
    `;
    
    // Add styles
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        z-index: 10000;
        max-width: 400px;
        animation: slideInRight 0.3s ease-out;
    `;
    
    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    `;
    document.head.appendChild(style);
    
    // Add to page
    document.body.appendChild(notification);
    
    // Close button functionality
    const closeBtn = notification.querySelector('.notification-close');
    closeBtn.addEventListener('click', () => {
        notification.remove();
    });
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}

// Scroll effects
function initScrollEffects() {
    // Parallax effect for hero section
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const hero = document.querySelector('.hero');
        
        if (hero) {
            const rate = scrolled * -0.5;
            hero.style.transform = `translateY(${rate}px)`;
        }
    });
    
    // Fade in elements on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in');
            }
        });
    }, observerOptions);
    
    // Observe all sections
    document.querySelectorAll('section').forEach(section => {
        observer.observe(section);
    });
}

// Portfolio items functionality
function initPortfolioItems() {
    const portfolioItems = document.querySelectorAll('.portfolio-item');
    
    portfolioItems.forEach(item => {
        item.addEventListener('click', function() {
            // Add click effect
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
            
            // Here you could add modal or navigation to project details
            console.log('Portfolio item clicked:', this.querySelector('h3').textContent);
        });
        
        // Add hover effects
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-10px) scale(1.02)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
}

// Utility functions
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Window resize handler
window.addEventListener('resize', debounce(function() {
    // Handle responsive adjustments
    const navMenu = document.querySelector('.nav-menu');
    const hamburger = document.querySelector('.hamburger');
    
    if (window.innerWidth > 768) {
        navMenu.classList.remove('active');
        hamburger.classList.remove('active');
    }
}, 250));

// Loading screen management
window.addEventListener('load', function() {
    const loadingScreen = document.getElementById('loading-screen');
    
    // Hide loading screen after a brief delay
    setTimeout(() => {
        loadingScreen.classList.add('hide');
        document.body.classList.add('loaded');
        
        // Remove loading screen from DOM after transition
        setTimeout(() => {
            if (loadingScreen.parentNode) {
                loadingScreen.remove();
            }
        }, 500);
    }, 1500); // Show loading for 1.5 seconds
});
